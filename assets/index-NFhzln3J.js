import{c as _,r as o,j as e,U as $,V as ee,B as v,X as se,a2 as ae,a3 as te,a4 as le,a5 as ne,a6 as ie,a7 as re,b as h,D as O,e as R,f as A,g as k,h as P,i as B,y as de,a as F,t as ce,d as oe,W as xe,l as me,m as ue,n as he,o as je,p as C,q as pe}from"./index-CfFH1LjD.js";import{u as V,h as ge}from"./hooks-wJSTJ-Ih.js";import{l as N,B as fe}from"./options-BrKX2hC9.js";import{C as T,a as ve,b as Ne,d as be,c as q}from"./card-DN_1rcS3.js";import{S as U,a as H,b as Y,c as W,d as w}from"./select-Bk9xR7qg.js";import{T as Se,a as Ce,b as I,c as g,d as we,e as f}from"./table-BvOW7uUv.js";import{L as y}from"./label-50ah4DG1.js";import{u as D}from"./hooks-DvHM9WGX.js";import{T as ye}from"./textarea-Cta2LOrO.js";import{P as De}from"./plus-yty04Od8.js";import{E as Le}from"./ellipsis-OW6600zT.js";/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=_("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);function Me({options:n,onSelect:l,placeholder:d,value:i,disabled:m,className:u}){const[t,r]=o.useState(!1),[j,a]=o.useState();return o.useEffect(()=>{if(i){const c=n.find(b=>b.value===i);c&&a(c)}else a(void 0)},[n]),e.jsxs($,{open:t,onOpenChange:r,children:[e.jsx(ee,{asChild:!0,disabled:m,className:u,children:e.jsxs(v,{variant:"outline",role:"combobox","aria-expanded":t,className:"max-w-full justify-between font-normal",children:[j?e.jsx("div",{className:"flex",children:j.label}):e.jsx("div",{className:"flex opacity-50",children:d}),e.jsx(Ee,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(se,{className:"max-w-full p-0 text-ellipsis",children:e.jsxs(ae,{children:[e.jsx(te,{placeholder:"Tìm..."}),e.jsxs(le,{children:[e.jsx(ne,{children:"Không có kết quả"}),e.jsx(ie,{children:n.map(c=>e.jsx(re,{onSelect:()=>{a(c),l(c.value),r(!1)},children:e.jsx("span",{className:"text-ellipsis",children:c.label})},c.value))})]})]})})]})}const Te=({onClose:n,liquidation:l})=>{const{updateLiquidation:d}=D(h(t=>({updateLiquidation:t.updateLiquidation}))),[i,m]=o.useState(l.status),u=async()=>{if(i===l.status){n();return}const t=de.cloneDeep(l);t.status=i,await d(t.id,t)};return e.jsx(O,{open:!0,onOpenChange:t=>{t||n()},children:e.jsxs(R,{className:"sm:max-w-[425px]",children:[e.jsxs(A,{children:[e.jsx(k,{children:"Edit Liquidation Status"}),e.jsx(P,{children:"Please select the status of this liquidation request."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(y,{htmlFor:"device-name",className:"text-right",children:["Status",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(U,{value:i,onValueChange:t=>m(t),children:[e.jsx(H,{className:"w-full sm:w-[180px]",children:e.jsx(Y,{placeholder:"Filter by status"})}),e.jsx(W,{children:Object.entries(N).map(([t,{name:r}])=>e.jsx(w,{value:t,children:r},t))})]})]})}),e.jsx(B,{children:e.jsx(v,{type:"submit",onClick:u,children:"Submit"})})]})})},qe=({onClose:n,liquidation:l})=>{const{userInfo:d}=F(h(a=>({userInfo:a.info}))),{createLiquidation:i,updateLiquidation:m}=D(h(a=>({createLiquidation:a.createLiquidation,updateLiquidation:a.updateLiquidation}))),{devices:u}=V(h(a=>({devices:a.data}))),[t,r]=o.useState({deviceId:(l==null?void 0:l.deviceId)||"",reason:(l==null?void 0:l.reason)||""}),j=async()=>{if(!t.deviceId||!t.reason){ce({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}const a={...l,...t};l!=null&&l.id||(a.status="pending",a.requestBy=d==null?void 0:d.id),l?m(l.id,a):await i(a),n()};return e.jsx(O,{open:!0,onOpenChange:a=>{a||n()},children:e.jsxs(R,{className:"sm:max-w-[425px]",children:[e.jsxs(A,{children:[e.jsx(k,{children:l?"Edit Liquidation":"Create Liquidation"}),e.jsx(P,{children:"Enter the details of the device you want to liquidate."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(y,{htmlFor:"device-name",className:"text-right",children:["Device",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Me,{disabled:!!l,className:"w-full col-span-3",options:Object.values(u).map(a=>({label:a.name,value:a.id.toString()})),value:t.deviceId,onSelect:a=>r({...t,deviceId:a.toString()})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(y,{htmlFor:"reason",className:"text-right",children:["Reason",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ye,{id:"reason",className:"col-span-3",value:t.reason,onChange:a=>r({...t,reason:a.target.value})})]})]}),e.jsx(B,{children:e.jsx(v,{type:"submit",onClick:j,children:"Submit"})})]})})};function Ye(){const[n,l]=o.useState("All"),[d,i]=o.useState(),[m,u]=o.useState(),{handling:t,liquidations:r,getLiquidations:j,deleteLiquidation:a}=D(h(s=>({handling:s.handling,liquidations:s.data,getLiquidations:s.getLiquidations,deleteLiquidation:s.deleteLiquidation}))),{devices:c,getDevices:b}=V(h(s=>({devices:s.data,getDevices:s.getDevices}))),{users:G}=oe(h(s=>({users:s.data.users}))),{isAdmin:S,isMaintenance:L,isManager:K}=F(h(s=>({isAdmin:s.isAdmin,isManager:s.isManager,isMaintenance:s.isMaintenance})));o.useEffect(()=>{j(),Object.keys(c).length||b()},[]);const Q=o.useMemo(()=>Object.values(r).filter(s=>n==="All"||s.status===n),[r,n]),{total:X,pending:z,approved:J,reject:Z}=o.useMemo(()=>Object.values(r).reduce((x,p)=>(x.total++,p.status==="pending"&&x.pending++,p.status==="approved"&&x.approved++,p.status==="reject"&&x.reject++,x),{total:0,pending:0,approved:0,reject:0}),[r]);return e.jsxs("div",{className:"container mx-auto",children:[t?e.jsx(xe,{}):null,d?e.jsx(qe,{liquidation:Object.keys(d).length?d:void 0,onClose:()=>i(void 0)}):null,m?e.jsx(Te,{liquidation:m,onClose:()=>u(void 0)}):null,e.jsx("div",{}),e.jsxs(T,{className:"mb-6",children:[e.jsxs(ve,{className:"flex flex-row justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx(Ne,{children:"Liquidation Request Overview"}),e.jsx(be,{children:"Quick summary of liquidation requests"})]}),L||S?e.jsxs(v,{onClick:()=>i({}),children:[e.jsx(De,{className:"mr-2 h-4 w-4"})," New Request"]}):null]}),e.jsxs(q,{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-2xl font-bold",children:X}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Requests"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-2xl font-bold text-yellow-500",children:z}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Pending"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-2xl font-bold text-green-500",children:J}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Approved"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-2xl font-bold text-red-500",children:Z}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Rejected"})]})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-end items-center mb-4 space-y-2 sm:space-y-0",children:e.jsxs(U,{onValueChange:s=>l(s),children:[e.jsx(H,{className:"w-full sm:w-[180px]",children:e.jsx(Y,{placeholder:"Filter by status"})}),e.jsxs(W,{children:[e.jsx(w,{value:"All",children:"All"}),Object.entries(N).map(([s,{name:x}])=>e.jsx(w,{value:s,children:x},s))]})]})}),e.jsx(T,{children:e.jsx(q,{className:"p-0",children:e.jsxs(Se,{children:[e.jsx(Ce,{children:e.jsxs(I,{children:[e.jsx(g,{children:"Device Name"}),e.jsx(g,{children:"Serial Number"}),e.jsx(g,{children:"Request Date"}),e.jsx(g,{children:"Request by"}),e.jsx(g,{children:"Status"}),e.jsx(g,{className:"text-right",children:"Actions"})]})}),e.jsx(we,{children:Q.map(s=>{var x,p,E,M;return e.jsxs(I,{children:[e.jsx(f,{className:"font-medium",children:((x=c[s.deviceId])==null?void 0:x.name)||s.deviceId}),e.jsx(f,{children:(p=c[s.deviceId])==null?void 0:p.serial}),e.jsx(f,{children:ge(s.createdAt).format("MMM DD, YYYY")}),e.jsx(f,{children:((E=G[s.requestBy])==null?void 0:E.name)||s.requestBy}),e.jsx(f,{children:e.jsx(fe,{style:{backgroundColor:(M=N[s.status])==null?void 0:M.color},children:N[s.status].name})}),e.jsx(f,{className:"text-right",children:e.jsxs(me,{children:[e.jsx(ue,{asChild:!0,children:e.jsxs(v,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Le,{className:"h-4 w-4"})]})}),e.jsxs(he,{align:"end",children:[e.jsx(je,{children:"Actions"}),L||S?e.jsx(C,{onSelect:()=>i(s),children:"Edit Request"}):null,K||S?e.jsx(C,{onSelect:()=>u(s),children:"Change Status"}):null,e.jsx(pe,{}),e.jsx(C,{className:"text-red-600",onSelect:()=>a(s.id),children:"Delete Request"})]})]})})]},s.id)})})]})})})]})}export{Ye as default};
