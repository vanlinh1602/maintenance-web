import{b as v,d as L,r as c,t as x,j as e,D as W,W as P,e as B,f as Y,g as H,h as $,i as X,B as k,k as z,u as G,a as J,l as Q,m as Z,n as _,o as K,p as y,q as ee}from"./index-CfFH1LjD.js";import{u as U,h as se}from"./hooks-wJSTJ-Ih.js";import{d as A,B as ae}from"./options-BrKX2hC9.js";import{C as te,a as re,b as ie,d as le,c as ne,e as ce}from"./card-DN_1rcS3.js";import{I as h}from"./input-CpeUivEp.js";import{L as n}from"./label-50ah4DG1.js";import{S as w,a as C,b,c as E,d as T}from"./select-Bk9xR7qg.js";import{T as de}from"./textarea-Cta2LOrO.js";import{X as oe,S as me}from"./x-BXQsfHI0.js";import{R as xe}from"./index-BSUFXHe-.js";import"./calendar-BbxLq_4U.js";import{P as he}from"./plus-yty04Od8.js";import{E as pe}from"./ellipsis-OW6600zT.js";import"./hooks-ceS6wIrN.js";const ue=({device:r,onClose:f})=>{const{createDevice:I,updateDevice:M}=U(v(s=>({createDevice:s.createDevice,updateDevice:s.updateDevice}))),{users:F,rooms:O,types:q}=L(v(s=>({rooms:s.data.rooms,users:s.data.users,types:s.data.device.type}))),[R,p]=c.useState(!1),[t,l]=c.useState(r),[m,u]=c.useState(),[o,g]=c.useState(),[d,N]=c.useState();c.useEffect(()=>{r.purchaseDate&&u(new Date(r.purchaseDate)),r.assignedDate&&g(new Date(r.assignedDate)),r.warrantyExpireDate&&N(new Date(r.warrantyExpireDate))},[r]);const a=c.useCallback(s=>{if(!s.name)return x({title:"Error",description:"Name is required",variant:"destructive"}),!1;if(!s.serial)return x({title:"Error",description:"Serial is required",variant:"destructive"}),!1;if(!s.purchaseDate)return x({title:"Error",description:"Purchase date is required",variant:"destructive"}),!1;if(s.warrantyExpireDate){if(s.warrantyExpireDate<s.purchaseDate)return x({title:"Error",description:"Warranty expire date must be greater than purchase date",variant:"destructive"}),!1}else return x({title:"Error",description:"Warranty expire date is required",variant:"destructive"}),!1;if(s.assignedDate&&s.assignedDate<s.purchaseDate)return x({title:"Error",description:"Assigned date must be greater than purchase date",variant:"destructive"}),!1;if(!s.status)return x({title:"Error",description:"Status is required",variant:"destructive"}),!1;if(!s.type){x({title:"Error",description:"Type is required",variant:"destructive"});return}return!0},[]),D=async s=>{var i;try{p(!0);const j=(i=s.target.files)==null?void 0:i[0];if(!j)return;const V=await z(j);l({...t,image:V})}finally{p(!1)}},S=()=>{const s={...t,purchaseDate:m==null?void 0:m.getTime(),assignedDate:o==null?void 0:o.getTime(),warrantyExpireDate:d==null?void 0:d.getTime()};a(s)&&(r.id?M(r.id,s):I(s),f())};return e.jsxs(W,{open:!0,onOpenChange:s=>{s||f()},children:[R?e.jsx(P,{}):null,e.jsxs(B,{className:"w-[800px] container max-w-[800px]",children:[e.jsxs(Y,{children:[e.jsx(H,{children:r.id?`Edit ${r.name}`:"Create new device"}),e.jsx($,{children:"Enter the details of the device here. Click save when you're done."})]}),e.jsxs("div",{className:"grid gap-4 grid-cols-2 py-4",children:[e.jsxs("div",{className:"flex flex-row gap-4 col-span-2",children:[e.jsx("div",{children:e.jsxs("div",{className:"items-center gap-4 ",children:[e.jsx(n,{htmlFor:"image",className:"text-right"}),t.image?e.jsxs("div",{className:"w-52 h-52",children:[e.jsx("div",{className:"absolute left-52 text-destructive h-6 w-6 cursor-pointer bg-white rounded-lg",children:e.jsx(oe,{onClick:()=>l({...t,image:""})})}),e.jsx("img",{src:t.image,alt:"device",className:"w-52 h-52 object-cover"})]}):e.jsx(h,{type:"file",id:"image",className:"w-52 h-52 justify-center text-cente items-center",placeholder:"Upload image",content:"Upload image",accept:"image/*",multiple:!1,onChange:D})]})}),e.jsxs("div",{className:"grid grid-cols-1 w-full",children:[e.jsxs("div",{className:"items-center gap-4",children:[e.jsxs(n,{htmlFor:"name",className:"text-right",children:["Name",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(h,{id:"name",value:t.name,onChange:s=>l({...t,name:s.target.value})})]}),e.jsxs("div",{className:"items-center gap-4",children:[e.jsxs(n,{htmlFor:"type",className:"text-right",children:["Serial",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(h,{id:"serial",value:t.serial,onChange:s=>l({...t,serial:s.target.value})})]}),e.jsxs("div",{className:"items-center gap-4",children:[e.jsxs(n,{htmlFor:"type",className:"text-right",children:["Type",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs(w,{onValueChange:s=>l({...t,type:s}),value:t.type,children:[e.jsx(C,{className:"col-span-3",children:e.jsx(b,{placeholder:"Select status"})}),e.jsx(E,{children:Object.entries(q).map(([s,i])=>e.jsx(T,{value:s,children:i.name},s))})]})]})]})]}),e.jsxs("div",{className:"col-span-2  items-center gap-4",children:[e.jsx(n,{htmlFor:"description",className:"text-right",children:"Description"}),e.jsx(de,{id:"description",className:"col-span-3",value:t.description,onChange:s=>l({...t,description:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(n,{htmlFor:"maintenance-date",className:"text-right",children:["Purchase Date",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(h,{className:"col-span-3",type:"date",value:m==null?void 0:m.toISOString().split("T")[0],onChange:s=>{u(new Date(s.target.value))}})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(n,{htmlFor:"warranty-expire-date",className:"text-right",children:["Warranty Expire Date",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(h,{className:"col-span-3",type:"date",value:d==null?void 0:d.toISOString().split("T")[0],onChange:s=>{N(new Date(s.target.value))}})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(n,{htmlFor:"assigned-date",className:"text-right",children:"Assigned Date"}),e.jsx(h,{className:"col-span-3",type:"date",value:o==null?void 0:o.toISOString().split("T")[0],onChange:s=>{g(new Date(s.target.value))}})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(n,{htmlFor:"status",className:"text-right",children:["Status",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs(w,{onValueChange:s=>l({...t,status:s}),value:t.status,children:[e.jsx(C,{className:"col-span-3",children:e.jsx(b,{placeholder:"Select status"})}),e.jsx(E,{children:Object.entries(A).map(([s,i])=>e.jsx(T,{value:s,children:i.name},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(n,{htmlFor:"room",className:"text-right",children:"Room"}),e.jsxs(w,{onValueChange:s=>l({...t,roomId:s}),value:t.roomId,children:[e.jsx(C,{className:"col-span-3",children:e.jsx(b,{placeholder:"Select room"})}),e.jsx(E,{children:Object.entries(O).map(([s,i])=>e.jsx(T,{value:s,children:i.name},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(n,{htmlFor:"employee",className:"text-right",children:"User"}),e.jsxs(w,{onValueChange:s=>l({...t,employeeId:s}),value:t.employeeId,children:[e.jsx(C,{className:"col-span-3",children:e.jsx(b,{placeholder:"Select employee"})}),e.jsx(E,{children:Object.entries(F).map(([s,i])=>e.jsx(T,{value:s,children:i.name},s))})]})]})]}),e.jsx(X,{children:e.jsx(k,{type:"submit",onClick:S,children:"Save changes"})})]})]})};function Me(){const r=G(),{handling:f,devices:I,getDevices:M,deleteDevice:F}=U(v(a=>({handling:a.handling,devices:a.data,getDevices:a.getDevices,deleteDevice:a.deleteDevice}))),{users:O,rooms:q,deviceTypes:R}=L(v(a=>({rooms:a.data.rooms,users:a.data.users,deviceTypes:a.data.device.type}))),{isMaintenance:p,isManager:t}=J(v(a=>({isMaintenance:a.isMaintenance,isManager:a.isManager})));c.useEffect(()=>{M()},[]);const[l,m]=c.useState(""),[u,o]=c.useState(),[g,d]=c.useState(),N=Object.values(I).filter(a=>a.name.toLowerCase().includes(l.toLowerCase()));return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[f?e.jsx(P,{}):null,g?e.jsx(ue,{device:g,onClose:()=>d(void 0)}):null,u?e.jsx(xe,{device:u,onClose:()=>o(void 0)}):null,e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Device Management"}),p||t?e.jsxs(k,{onClick:()=>d({}),children:[e.jsx(he,{className:"mr-2 h-4 w-4"})," Add New Device"]}):null]}),e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(h,{type:"search",placeholder:"Search device...",className:"pl-8 md:w-[300px] lg:w-[300px] bg-white",value:l,onChange:a=>m(a.target.value)})]})})}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:N.map(a=>{var D,S,s,i,j;return e.jsxs(te,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("img",{src:a.image,alt:a.name,className:"h-16 w-16 rounded-md object-cover"}),e.jsxs("div",{children:[e.jsx(ie,{children:a.name}),e.jsxs(le,{children:[(D=R[a.type])==null?void 0:D.name,e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Serial:"})," ",a.serial]})]})]})]})}),e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col justify-start",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Room:"," ",((S=q[a.roomId||""])==null?void 0:S.name)||"Not assigned to any room"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["User:"," ",((s=O[a.employeeId||""])==null?void 0:s.name)||"Not assigned to any user"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(ae,{style:{backgroundColor:(i=A[a.status])==null?void 0:i.color},children:(j=A[a.status])==null?void 0:j.name}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Last Assign:"," ",se(a.assignedDate).format("DD/MM/YYYY")]})]})]}),e.jsx(ce,{className:"flex justify-end",children:e.jsxs(Q,{children:[e.jsx(Z,{asChild:!0,children:e.jsxs(k,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(pe,{className:"h-4 w-4"})]})}),e.jsxs(_,{align:"end",children:[e.jsx(K,{children:"Actions"}),e.jsx(y,{onSelect:()=>r(`/device/${a.id}`),children:"View Details"}),p||t?e.jsx(y,{onSelect:()=>d(a),children:"Edit Device"}):null,e.jsx(y,{onSelect:()=>o(a),children:"Request Repair"}),p||t?e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsx(y,{className:"text-red-600",onSelect:()=>F(a.id),children:"Delete Device"})]}):null]})]})})]},a.id)})})]})}export{Me as default};
