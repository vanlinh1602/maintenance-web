import{c as ce,r as l,j as e,D as S,i as D,k as C,l as M,m as b,p as k,B as p,t as q,e as le,f,h as de,P as ge,n as ve,o as fe,u as ye,_ as Ne,W as Se}from"./index-Cw7UTnmX.js";import{u as oe,h as g}from"./hooks-DUEf6Wgf.js";import{r as N,B as De,p as te}from"./options-Cf1MLeWf.js";import{C as ae,a as ne,b as ie,c as re}from"./card-BRWD3fE5.js";import{L as h}from"./label-B5bgNSYj.js";import{T as ue}from"./textarea-BvdFGMqn.js";import{S as $,a as F,b as E,c as L,d as B}from"./select-Bep9p-Vs.js";import"./input-DoXMFgNH.js";import{u as Ce}from"./hooks-BE1mY1X_.js";import{f as Me,C as be}from"./calendar-B5hFHp5d.js";import{P as ke}from"./plus-SGypoK3J.js";/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=ce("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=ce("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Ie=({onClose:x,onSubmit:d})=>{const[n,u]=l.useState(""),r=()=>{if(!n){q({title:"Note is required",variant:"destructive"});return}d(n)};return e.jsx(S,{open:!0,onOpenChange:c=>{c||x()},children:e.jsxs(D,{children:[e.jsxs(C,{children:[e.jsx(M,{children:"Add note"}),e.jsx(b,{children:"Add a note to this maintenance task."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(h,{htmlFor:"status-notes",className:"text-right",children:["Notes",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ue,{id:"status-notes",placeholder:"Add a note",className:"col-span-3",value:n,onChange:c=>u(c.target.value)})]})}),e.jsx(k,{children:e.jsx(p,{type:"submit",onClick:r,children:"Update Status"})})]})})},Ae=({onClose:x,onSubmit:d})=>{const[n,u]=l.useState(""),[r,c]=l.useState(""),{isManager:m}=le(f(i=>({isMaintenance:i.isMaintenance,isManager:i.isManager}))),v=l.useMemo(()=>m?N:Object.fromEntries(Object.entries(N).filter(([i])=>i!=="approved")),[m]),a=()=>{if(!n){q({title:"Status is required",variant:"destructive"});return}d(n,r)};return e.jsx(S,{open:!0,onOpenChange:i=>{i||x()},children:e.jsxs(D,{children:[e.jsxs(C,{children:[e.jsx(M,{children:"Update Maintenance Status"}),e.jsx(b,{children:"Change the current status of this maintenance task."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(h,{htmlFor:"status",className:"text-right",children:["Status",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs($,{onValueChange:i=>u(i),value:n,children:[e.jsx(F,{className:"col-span-3",children:e.jsx(E,{placeholder:"Select new status"})}),e.jsx(L,{children:Object.entries(v).map(([i,R])=>e.jsx(B,{value:i,style:{color:R.color},children:R.name},i))})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"status-notes",className:"text-right",children:"Notes"}),e.jsx(ue,{id:"status-notes",placeholder:"Add any relevant notes about this status change...",className:"col-span-3",value:r,onChange:i=>c(i.target.value)})]})]}),e.jsx(k,{children:e.jsx(p,{type:"submit",onClick:a,children:"Update Status"})})]})})},Oe=({onClose:x,onSubmit:d,currentDevice:n})=>{const{devices:u}=oe(f(a=>({devices:a.data}))),[r,c]=l.useState(""),m=l.useMemo(()=>Object.values(u).filter(a=>!(a.id===n||a.employeeId)),[u,n]),v=()=>{if(!r){q({title:"Device is required",variant:"destructive"});return}d(r)};return e.jsx(S,{open:!0,onOpenChange:a=>{a||x()},children:e.jsxs(D,{children:[e.jsxs(C,{children:[e.jsx(M,{children:"Replacement Device"}),e.jsx(b,{children:"Please select a device to replace the current device."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(h,{htmlFor:"status",className:"text-right",children:["Device",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs($,{onValueChange:a=>c(a),value:r,children:[e.jsx(F,{className:"col-span-3",children:e.jsx(E,{placeholder:"Select device"})}),e.jsx(L,{children:m.map(a=>e.jsx(B,{value:a.id,children:a.name},a.id))})]})]})}),e.jsx(k,{children:e.jsx(p,{type:"submit",onClick:v,children:"Save"})})]})})},Te=({onClose:x,onSubmit:d})=>{const{users:n,roles:u}=de(f(a=>({users:a.data.users,roles:a.data.roles}))),[r,c]=l.useState(""),m=l.useMemo(()=>Object.values(n).filter(a=>{var i;return((i=u[a.roleId])==null?void 0:i.isMaintenance)||!1}),[n,u]),v=()=>{if(!r){q({title:"User is required",variant:"destructive"});return}d(r)};return e.jsx(S,{open:!0,onOpenChange:a=>{a||x()},children:e.jsxs(D,{children:[e.jsxs(C,{children:[e.jsx(M,{children:"Assign"}),e.jsx(b,{children:"Assign this maintenance task to a user."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(h,{htmlFor:"status",className:"text-right",children:["Assign to",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs($,{onValueChange:a=>c(a),value:r,children:[e.jsx(F,{className:"col-span-3",children:e.jsx(E,{placeholder:"Select user"})}),e.jsx(L,{children:m.map(a=>e.jsx(B,{value:a.id,children:a.name},a.id))})]})]})}),e.jsx(k,{children:e.jsx(p,{type:"submit",onClick:v,children:"Update"})})]})})},Pe=({onClose:x,onSubmit:d})=>{const[n,u]=l.useState(),r=()=>{if(!n){q({title:"Date is required",variant:"destructive"});return}d(n.getTime())};return e.jsx(S,{open:!0,onOpenChange:c=>{c||x()},children:e.jsxs(D,{children:[e.jsxs(C,{children:[e.jsx(M,{children:"Schedule Maintenance"}),e.jsx(b,{children:"Schedule this maintenance task for a later date."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(h,{htmlFor:"status-notes",className:"text-right",children:["Date",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(ge,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:`col-span-3 ${!n&&"text-muted-foreground"}`,children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),n?Me(n,"dd/LL/y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(fe,{className:"w-auto p-0",children:e.jsx(be,{mode:"single",selected:n,onSelect:u,initialFocus:!0})})]})]})}),e.jsx(k,{children:e.jsx(p,{type:"submit",onClick:r,children:"Update Status"})})]})})};function _e(){var W,z,_,G,J,K,Q,X,Y,Z,ee;const x=ye(),{id:d}=Ne(),{handling:n,requests:u,getRequest:r,updateRequest:c}=Ce(f(t=>({handling:t.handling,requests:t.data,getRequest:t.getRequest,updateRequest:t.updateRequest}))),{devices:m,getDevices:v,updateDevice:a}=oe(f(t=>({devices:t.data,getDevices:t.getDevices,updateDevice:t.updateDevice}))),{requestType:i,deviceType:R,users:I}=de(f(t=>({requestType:t.data.request.type,deviceType:t.data.device.type,users:t.data.users}))),{userInfo:y,isMaintenance:V,isManager:H}=le(f(t=>({userInfo:t.info,isMaintenance:t.isMaintenance??!1,isManager:t.isManager}))),s=l.useMemo(()=>u[d]||{},[u,d]),A=l.useMemo(()=>m[s.deviceId]||{},[m,s.deviceId]);l.useEffect(()=>{d&&!(s!=null&&s.id)&&r(d),Object.keys(m).length||v()},[m,s.id,r,v,d]);const[he,O]=l.useState(!1),[me,T]=l.useState(!1),[xe,P]=l.useState(!1),[pe,w]=l.useState(!1),[je,U]=l.useState(!1);return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[n&&e.jsx(Se,{}),he&&e.jsx(Ae,{onClose:()=>O(!1),onSubmit:(t,o)=>{var se;const j=s.notes||[];j.push({userId:y.id,message:`Change status to ${((se=N[t])==null?void 0:se.name)||t}${o?`: ${o}`:""}`,timestamp:g().valueOf()}),c(s.id,{status:t,notes:j}),O(!1)}}),me&&e.jsx(Te,{onClose:()=>T(!1),onSubmit:t=>{var j;const o=s.notes||[];o.push({userId:y.id,message:`Assigned to ${(j=I[t])==null?void 0:j.name}`,timestamp:g().valueOf()}),c(s.id,{assignedTo:t,notes:o}),T(!1)}}),xe&&e.jsx(Ie,{onClose:()=>P(!1),onSubmit:t=>{const o=s.notes||[];o.push({userId:y.id,message:t,timestamp:g().valueOf()}),c(s.id,{notes:o}),P(!1)}}),pe&&e.jsx(Pe,{onClose:()=>w(!1),onSubmit:t=>{const o=s.notes||[];o.push({userId:y.id,message:`Scheduled maintenance on ${g(t).format("MMMM DD, yyyy")}`,timestamp:g().valueOf()}),c(s.id,{scheduledDate:t,notes:o}),w(!1)}}),je&&e.jsx(Oe,{currentDevice:d,onClose:()=>U(!1),onSubmit:t=>{var j;const o=s.notes||[];o.push({userId:y.id,message:`Replaced with ${((j=m[t])==null?void 0:j.name)||t}`,timestamp:g().valueOf()}),c(s.id,{replacementDeviceId:t,notes:o}),a(t,{employeeId:A.employeeId}),U(!1)}}),e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx(p,{className:"text-3xl font-bold p-0",variant:"link",onClick:()=>x(`/device/${A.id}`),children:A.name}),e.jsx("p",{className:"text-xl text-muted-foreground",children:(W=R[A.type])==null?void 0:W.name})]}),e.jsx(De,{style:{backgroundColor:(z=i[s.type])==null?void 0:z.color},className:"text-lg py-1 px-3",children:(_=i[s.type])==null?void 0:_.name})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(ae,{children:[e.jsx(ne,{children:e.jsx(ie,{children:"Request Details"})}),e.jsxs(re,{className:"grid gap-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("img",{src:s.image,alt:"device",className:"w-60 object-cover rounded-md"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Create Date"}),e.jsx("p",{children:g(s.createdAt).format("MMMM DD, yyyy")})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Creator"}),e.jsx("p",{children:((G=I[s.creator])==null?void 0:G.name)||s.creator})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Priority"}),e.jsx("p",{style:{color:(J=te[s.priority])==null?void 0:J.color},children:(K=te[s.priority])==null?void 0:K.name})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Assign To"}),e.jsx("p",{children:(Q=I[s.assignedTo||""])==null?void 0:Q.name})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Shecduled Date"}),e.jsx("p",{children:s.scheduledDate?g(s.scheduledDate).format("MMMM DD, yyyy"):"Not scheduled"})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Status"}),e.jsx("p",{style:{color:(X=N[s.status])==null?void 0:X.color},children:(Y=N[s.status])==null?void 0:Y.name})]}),e.jsxs("div",{children:[e.jsxs(h,{className:"flex",children:["Replacement Device",e.jsx(Re,{onClick:()=>U(!0),className:"h-4 w-4 ml-2"})]}),e.jsx(p,{variant:"link",className:"p-0 m-0",onClick:()=>x(`/device/${s.replacementDeviceId}`),children:((Z=m[s.replacementDeviceId||""])==null?void 0:Z.name)||s.replacementDeviceId})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Description"}),e.jsx("p",{children:s.description})]}),e.jsxs("div",{className:"space-x-2",children:[V&&s.status!=="pending"||H?e.jsx(p,{onClick:()=>O(!0),children:"Update Status"}):null,H&&e.jsx(p,{onClick:()=>T(!0),variant:"secondary",children:"Assign To"}),V&&s.status!=="pending"&&e.jsx(p,{onClick:()=>w(!0),variant:"secondary",children:"Schedule"})]})]})]}),e.jsxs(ae,{children:[e.jsx(ne,{children:e.jsxs(ie,{className:"flex justify-between",children:["Request Notes",e.jsxs(p,{variant:"outline",onClick:()=>P(!0),className:"flex items-center space-x-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Add Note"]})]})}),e.jsx(re,{children:e.jsx("div",{className:"space-y-2",children:(ee=s.notes)==null?void 0:ee.map((t,o)=>{var j;return e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"font-semibold",children:((j=I[t.userId])==null?void 0:j.name)||t.userId}),e.jsx("p",{className:"text-sm text-muted-foreground",children:g(s.createdAt).format("MMMM DD, yyyy")})]}),e.jsx("p",{className:"mt-2",children:t.message})]},o)})})})]})]})]})}export{_e as default};
