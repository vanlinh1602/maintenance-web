import{c as ce,r as c,j as e,D as S,i as D,k as C,l as M,m as b,p as k,B as p,t as q,e as le,f,h as de,P as ge,n as ve,o as fe,u as ye,S as Ne,W as Se}from"./index-DVFDKlcv.js";import{u as oe,h as g}from"./hooks-28YVt9aP.js";import{r as N,B as De,p as te}from"./options-YKJpdElC.js";import{C as ae,a as ne,b as ie,c as re}from"./card-PyWpcb_t.js";import{L as h}from"./label-DuOUMB3r.js";import{T as ue}from"./textarea-B-3oHILt.js";import{S as $,a as F,b as E,c as L,d as B}from"./select-Bn3wcZhV.js";import{u as Ce}from"./hooks-CYUBZkOm.js";import{f as Me,C as be}from"./calendar-CHF10eXH.js";import{P as ke}from"./plus-BRTevXWx.js";/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=ce("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=ce("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Ie=({onClose:x,onSubmit:l})=>{const[n,u]=c.useState(""),i=()=>{if(!n){q({title:"Note is required",variant:"destructive"});return}l(n)};return e.jsx(S,{open:!0,onOpenChange:r=>{r||x()},children:e.jsxs(D,{children:[e.jsxs(C,{children:[e.jsx(M,{children:"Add note"}),e.jsx(b,{children:"Add a note to this maintenance task."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(h,{htmlFor:"status-notes",className:"text-right",children:["Notes",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ue,{id:"status-notes",placeholder:"Add a note",className:"col-span-3",value:n,onChange:r=>u(r.target.value)})]})}),e.jsx(k,{children:e.jsx(p,{type:"submit",onClick:i,children:"Update Status"})})]})})},Ae=({onClose:x,onSubmit:l})=>{const[n,u]=c.useState(""),[i,r]=c.useState(""),{isManager:m}=le(f(d=>({isMaintenance:d.isMaintenance,isManager:d.isManager}))),v=c.useMemo(()=>m?N:Object.fromEntries(Object.entries(N).filter(([d])=>d!=="approved")),[m]),a=()=>{if(!n){q({title:"Status is required",variant:"destructive"});return}l(n,i)};return e.jsx(S,{open:!0,onOpenChange:d=>{d||x()},children:e.jsxs(D,{children:[e.jsxs(C,{children:[e.jsx(M,{children:"Update Maintenance Status"}),e.jsx(b,{children:"Change the current status of this maintenance task."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(h,{htmlFor:"status",className:"text-right",children:["Status",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs($,{onValueChange:d=>u(d),value:n,children:[e.jsx(F,{className:"col-span-3",children:e.jsx(E,{placeholder:"Select new status"})}),e.jsx(L,{children:Object.entries(v).map(([d,R])=>e.jsx(B,{value:d,style:{color:R.color},children:R.name},d))})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"status-notes",className:"text-right",children:"Notes"}),e.jsx(ue,{id:"status-notes",placeholder:"Add any relevant notes about this status change...",className:"col-span-3",value:i,onChange:d=>r(d.target.value)})]})]}),e.jsx(k,{children:e.jsx(p,{type:"submit",onClick:a,children:"Update Status"})})]})})},Oe=({onClose:x,onSubmit:l,currentDevice:n})=>{const{devices:u}=oe(f(a=>({devices:a.data}))),[i,r]=c.useState(""),m=c.useMemo(()=>Object.values(u).filter(a=>!(a.id===n||a.employeeId)),[u,n]),v=()=>{if(!i){q({title:"Device is required",variant:"destructive"});return}l(i)};return e.jsx(S,{open:!0,onOpenChange:a=>{a||x()},children:e.jsxs(D,{children:[e.jsxs(C,{children:[e.jsx(M,{children:"Replacement Device"}),e.jsx(b,{children:"Please select a device to replace the current device."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(h,{htmlFor:"status",className:"text-right",children:["Device",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs($,{onValueChange:a=>r(a),value:i,children:[e.jsx(F,{className:"col-span-3",children:e.jsx(E,{placeholder:"Select user"})}),e.jsx(L,{children:m.map(a=>e.jsx(B,{value:a.id,children:a.name},a.id))})]})]})}),e.jsx(k,{children:e.jsx(p,{type:"submit",onClick:v,children:"Save"})})]})})},Te=({onClose:x,onSubmit:l})=>{const{users:n,roles:u}=de(f(a=>({users:a.data.users,roles:a.data.roles}))),[i,r]=c.useState(""),m=c.useMemo(()=>Object.values(n).filter(a=>u[a.roleId].isMaintenance),[n,u]),v=()=>{if(!i){q({title:"User is required",variant:"destructive"});return}l(i)};return e.jsx(S,{open:!0,onOpenChange:a=>{a||x()},children:e.jsxs(D,{children:[e.jsxs(C,{children:[e.jsx(M,{children:"Assign"}),e.jsx(b,{children:"Assign this maintenance task to a user."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(h,{htmlFor:"status",className:"text-right",children:["Assign to",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs($,{onValueChange:a=>r(a),value:i,children:[e.jsx(F,{className:"col-span-3",children:e.jsx(E,{placeholder:"Select user"})}),e.jsx(L,{children:m.map(a=>e.jsx(B,{value:a.id,children:a.name},a.id))})]})]})}),e.jsx(k,{children:e.jsx(p,{type:"submit",onClick:v,children:"Update"})})]})})},Pe=({onClose:x,onSubmit:l})=>{const[n,u]=c.useState(),i=()=>{if(!n){q({title:"Date is required",variant:"destructive"});return}l(n.getTime())};return e.jsx(S,{open:!0,onOpenChange:r=>{r||x()},children:e.jsxs(D,{children:[e.jsxs(C,{children:[e.jsx(M,{children:"Schedule Maintenance"}),e.jsx(b,{children:"Schedule this maintenance task for a later date."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(h,{htmlFor:"status-notes",className:"text-right",children:["Date",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(ge,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:`col-span-3 ${!n&&"text-muted-foreground"}`,children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),n?Me(n,"dd/LL/y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(fe,{className:"w-auto p-0",children:e.jsx(be,{mode:"single",selected:n,onSelect:u,initialFocus:!0})})]})]})}),e.jsx(k,{children:e.jsx(p,{type:"submit",onClick:i,children:"Update Status"})})]})})};function ze(){var W,z,G,J,K,Q,X,Y,Z,_,ee;const x=ye(),{id:l}=Ne(),{handling:n,requests:u,getRequest:i,updateRequest:r}=Ce(f(s=>({handling:s.handling,requests:s.data,getRequest:s.getRequest,updateRequest:s.updateRequest}))),{devices:m,getDevices:v,updateDevice:a}=oe(f(s=>({devices:s.data,getDevices:s.getDevices,updateDevice:s.updateDevice}))),{requestType:d,deviceType:R,users:I}=de(f(s=>({requestType:s.data.request.type,deviceType:s.data.device.type,users:s.data.users}))),{userInfo:y,isMaintenance:V,isManager:H}=le(f(s=>({userInfo:s.info,isMaintenance:s.isMaintenance,isManager:s.isManager}))),t=c.useMemo(()=>u[l]||{},[u,l]),A=c.useMemo(()=>m[t.deviceId]||{},[m,t.deviceId]);c.useEffect(()=>{l&&!(t!=null&&t.id)&&i(l),Object.keys(m).length||v()},[m,t.id,i,v,l]);const[he,O]=c.useState(!1),[me,T]=c.useState(!1),[xe,P]=c.useState(!1),[pe,U]=c.useState(!1),[je,w]=c.useState(!1);return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[n&&e.jsx(Se,{}),he&&e.jsx(Ae,{onClose:()=>O(!1),onSubmit:(s,o)=>{var se;const j=t.notes||[];j.push({userId:y.id,message:`Change status to ${((se=N[s])==null?void 0:se.name)||s}${o?`: ${o}`:""}`,timestamp:g().valueOf()}),r(t.id,{status:s,notes:j}),O(!1)}}),me&&e.jsx(Te,{onClose:()=>T(!1),onSubmit:s=>{var j;const o=t.notes||[];o.push({userId:y.id,message:`Assigned to ${(j=I[s])==null?void 0:j.name}`,timestamp:g().valueOf()}),r(t.id,{assignedTo:s,notes:o}),T(!1)}}),xe&&e.jsx(Ie,{onClose:()=>P(!1),onSubmit:s=>{const o=t.notes||[];o.push({userId:y.id,message:s,timestamp:g().valueOf()}),r(t.id,{notes:o}),P(!1)}}),pe&&e.jsx(Pe,{onClose:()=>U(!1),onSubmit:s=>{const o=t.notes||[];o.push({userId:y.id,message:`Scheduled maintenance on ${g(s).format("MMMM DD, yyyy")}`,timestamp:g().valueOf()}),r(t.id,{scheduledDate:s,notes:o}),U(!1)}}),je&&e.jsx(Oe,{currentDevice:l,onClose:()=>w(!1),onSubmit:s=>{var j;const o=t.notes||[];o.push({userId:y.id,message:`Replaced with ${((j=m[s])==null?void 0:j.name)||s}`,timestamp:g().valueOf()}),r(t.id,{replacementDeviceId:s,notes:o}),a(s,{employeeId:A.employeeId}),w(!1)}}),e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx(p,{className:"text-3xl font-bold p-0",variant:"link",onClick:()=>x(`/device/${A.id}`),children:A.name}),e.jsx("p",{className:"text-xl text-muted-foreground",children:(W=R[A.type])==null?void 0:W.name})]}),e.jsx(De,{style:{backgroundColor:(z=d[t.type])==null?void 0:z.color},className:"text-lg py-1 px-3",children:(G=d[t.type])==null?void 0:G.name})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(ae,{children:[e.jsx(ne,{children:e.jsx(ie,{children:"Request Details"})}),e.jsxs(re,{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Create Date"}),e.jsx("p",{children:g(t.createdAt).format("MMMM DD, yyyy")})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Creator"}),e.jsx("p",{children:((J=I[t.creator])==null?void 0:J.name)||t.creator})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Priority"}),e.jsx("p",{style:{color:(K=te[t.priority])==null?void 0:K.color},children:(Q=te[t.priority])==null?void 0:Q.name})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Assign To"}),e.jsx("p",{children:(X=I[t.assignedTo||""])==null?void 0:X.name})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Shecduled Date"}),e.jsx("p",{children:t.scheduledDate?g(t.scheduledDate).format("MMMM DD, yyyy"):"Not scheduled"})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Status"}),e.jsx("p",{style:{color:(Y=N[t.status])==null?void 0:Y.color},children:(Z=N[t.status])==null?void 0:Z.name})]}),e.jsxs("div",{children:[e.jsxs(h,{className:"flex",children:["Replacement Device",e.jsx(Re,{onClick:()=>w(!0),className:"h-4 w-4 ml-2"})]}),e.jsx(p,{variant:"link",className:"p-0 m-0",onClick:()=>x(`/device/${t.replacementDeviceId}`),children:((_=m[t.replacementDeviceId||""])==null?void 0:_.name)||t.replacementDeviceId})]})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Description"}),e.jsx("p",{children:t.description})]}),e.jsxs("div",{className:"space-x-2",children:[V&&t.status!=="pending"||H?e.jsx(p,{onClick:()=>O(!0),children:"Update Status"}):null,H&&e.jsx(p,{onClick:()=>T(!0),variant:"secondary",children:"Assign To"}),V&&t.status!=="pending"&&e.jsx(p,{onClick:()=>U(!0),variant:"secondary",children:"Schedule"})]})]})]}),e.jsxs(ae,{children:[e.jsx(ne,{children:e.jsxs(ie,{className:"flex justify-between",children:["Request Notes",e.jsxs(p,{variant:"outline",onClick:()=>P(!0),className:"flex items-center space-x-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Add Note"]})]})}),e.jsx(re,{children:e.jsx("div",{className:"space-y-2",children:(ee=t.notes)==null?void 0:ee.map((s,o)=>{var j;return e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"font-semibold",children:((j=I[s.userId])==null?void 0:j.name)||s.userId}),e.jsx("p",{className:"text-sm text-muted-foreground",children:g(t.createdAt).format("MMMM DD, yyyy")})]}),e.jsx("p",{className:"mt-2",children:s.message})]},o)})})})]})]})]})}export{ze as default};
